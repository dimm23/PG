# Printer Guard Selenium Testing
### Введение
Проект **PG** представляет собой комбинацию работы программы агента, который отслеживает печать, и веб интерфеса администратора, где устанавливаются правила и политики печати.

Тестирование данного проекта заключается в проверке работы веб интерфеса, а так же включает в себя интергационные тесты, которые проверяют результат печати в зависимости от установленных настроек и политик.

Для тестирования веб интерфеса используется фреймворк **Serenity + Cucumber**.
С помощью **Cucumber** пишутся BDD сценарии на русском языке для удобства чтения заказчиком.
**Serenity** включает в себя работу с веб драйвером браузера и формирование отчётов.

### Структура проекта
Проект автотестов, согласно паттерну PageObject, состоит из нескольких модулей:
* pages - классы страниц веб сайта, в которых описаны элементы;
* user - класс пользователя, в котором реализованы методы работы с элементами страниц.
* stepdefinitions - классы с реализацией шагов тестов, в которых объединены действия пользователя (типа клик на кнопку или ввод данных в поле) в отдельные более крупные действия (типа добавление / удаление политик).

Сценарии описаны в **feature** файлах и находятся они в папке ../resources/features.

Дополнительно в проекте реализован класс **TableRowsItems**, который представляет собой объект строки в таблице с названием и кнопками управления.
Нужен он для удобства работы со строками в таблице. Тоесть при создании объекта из этого класса мы передаём в него определённую строку в виде **WebElement-а** и далее можем кликать на кнопки этой строки не опасаясь что клик сработает для другой строки.

В папке **settings** находится класс **settings**, в котором хранятся данные для входа на сайт и для подключения к "компьютеру пользователя".

Другие настройки браузера описаны в файле **serenity.properties**, который находится в корневой директории проекта.
В этих настройках есть переключение режима запуска браузера - **headless**, тоесть процесс будет выполняться в фоновом режиме. 
Но для отладки его можно отключить (false) и тогда будет отображаться окно браузера с процессом выполнения теста.
Там же прописывается **базовый url** стенда для которого будут запускаться тесты.

### Детали реализации интеграционных тестов печати
Для того чтобы проверить отображение результата печати переходим на страницу **Журнал**, и в таблице наблюдаем с какого принтера каким пользователем и какой документ печатается.
А для того чтобы выполнить печать пользователем осуществляется отправка соответствующей команды на компьютер пользователя.
Для этого используется приложение **PsExec.exe** из средств администрирования Windows.

Реализация этого действия выполнена в классе **PrintingSteps** в папке **stepsdefinition** - метод **userPrintFile**.
Файл PsExec лежит в директории ../src/test/files/ и вызывается в консольном режиме с параметрами в зависимости от выполняемого действия.

Действия могут быть:
* Print_txt - печать текстового файла;
* Print_1doc - печать Word документа на 1 страницу;
* Print_20doc - печать Word документа на 2 страницы;
* SetColorTrueDuplexMode - установка настроек принтера на цветную двухстороннюю печать;
* SetColorTrueSimplexMode - установка настроек принтера на цветную одностороннюю печать;
* SetColorFalseDuplexMode - установка настроек принтера на черно-белую двухстороннюю печать;
* SetColorFalseSimplexMode - установка настроек принтера на черно-белую одностороннюю печать;

На стороне пользовательского компьютера установлено вспомогательное приложение **xStarter**, которое собственно и реализует перечисленные действия.
А в тестах для того чтобы **xStarter** выполнил эти действия на компьютере пользователя отправляется команда с помощью **PsExec**, которая на заданном компьютере выполняет консольную команду. 
В данном случае это запуск действия в приложении **xStarter**. 

Полностью команда выглядит следующим образом:

`psexec \\192.168.45.10 -u pg\printserver-admin -p 123qweASD "C:\Program Files (x86)\xStarter.exe" /run PG /taskname Print_1doc`

где:

`\\192.168.45.10 -u pg\printserver-admin -p 123qweASD` - параметры, в которых указывается компьютер на который отправляется команда и данные логина и пароля;

`"C:\Program Files (x86)\xStarter.exe" /run PG /taskname Print_1doc` - команда, которая выполняется на подключенном компьютере.

 
  
### Запуск тестов

Запускаются тесты командой **mvn clean verify**. При этом считываются настройки из **CucumberTestSuite.java**. 
Единственный параметр который можно менять это **tags**. В нём указывается что будут запускаться только те тесты у которых есть указанный тег. 
Остальные параметры остаются без изменений.

Для того чтобы команда **mvn clean verify** работала, необходимо установить **Maven**.
Иначе вы увидите в консоли ответ `"mvn" не является внутренней или внешней исполняемой командой`.

Чтобы установить Maven, необходимо скачать его с официального сайта (https://maven.apache.org/download.cgi) и распаковать определённое место, лучше всего в C:\Program Files\maven...
Далее прописать в глобальную переменную **PATH** среды Windows путь к **bin** директории в той папке куда вы разархивировали Maven.

Также для работы Maven-а потребуется установка JDK, который тоже можно скачать с официального сайта (https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html)

Для написания и редактирования тестов необходимо использовать IDE поддерживающую язык разработки Java.
Мой личный выбор IntelliJ IDEA (https://www.jetbrains.com/idea/download/)